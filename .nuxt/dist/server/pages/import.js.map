{"version":3,"file":"pages/import.js","sources":["webpack:///./pages/import.vue?f6b4","webpack:///./pages/import.vue?7305","webpack:///./pages/import.vue?c0f0","webpack:///./pages/import.vue?d5bc","webpack:///./models/Report.js","webpack:///./pages/import.vue","webpack:///./pages/import.vue?4152","webpack:///./pages/import.vue?1007"],"sourcesContent":["// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./import.vue?vue&type=style&index=0&id=ce08f6cc&lang=scss&scoped=true&\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add CSS to SSR context\nvar add = require(\"!../node_modules/vue-style-loader/lib/addStylesServer.js\").default\nmodule.exports.__inject__ = function (context) {\n  add(\"68798b24\", content, true, context)\n};","export * from \"-!../node_modules/vue-style-loader/index.js??ref--7-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./import.vue?vue&type=style&index=0&id=ce08f6cc&lang=scss&scoped=true&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".error[data-v-ce08f6cc]{color:red}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container\"},[(!_vm.isPasswordValid && !_vm.loading)?_vm._ssrNode(\"<div class=\\\"mt-5\\\" data-v-ce08f6cc>\",\"</div>\",[_c('b-row',{staticClass:\"mb-2\",attrs:{\"align-h\":\"center\"}},[_c('b-col',{attrs:{\"lg\":\"4\"}},[_c('b-form-input',{staticClass:\"import__password\",attrs:{\"placeholder\":\"Enter the password\",\"type\":\"password\",\"state\":_vm.isPasswordValid,\"aria-describedby\":\"input-live-feedback\"},nativeOn:{\"keydown\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.handlePasswordClick($event)}},model:{value:(_vm.password),callback:function ($$v) {_vm.password=$$v},expression:\"password\"}}),_vm._v(\" \"),_c('b-form-invalid-feedback',{attrs:{\"id\":\"input-live-feedback\"}},[_vm._v(\"\\n          Please check your password and try again\\n        \")])],1)],1),_vm._ssrNode(\" \"),_c('b-row',{attrs:{\"align-h\":\"center\"}},[_c('b-col',{attrs:{\"lg\":\"4\"}},[_c('b-button',{attrs:{\"href\":\"#\",\"block\":\"\",\"variant\":\"primary\"},on:{\"click\":_vm.handlePasswordClick}},[_vm._v(\"\\n          Go\\n        \")])],1)],1)],2):_vm._e(),_vm._ssrNode(\" \"),(_vm.isPasswordValid)?_vm._ssrNode(\"<div data-v-ce08f6cc>\",\"</div>\",[_c('b-row',{staticClass:\"text-center\"},[_c('b-col',{staticClass:\"mt-5\",attrs:{\"lg\":\"12\"}},[_c('h1',{staticClass:\"import__title\"},[_vm._v(\"\\n          Visit Seattle\\n        \")])])],1),_vm._ssrNode(\" \"),_c('b-row',{staticClass:\"mt-3\",attrs:{\"align-h\":\"center\"}},[_c('b-col',{attrs:{\"lg\":\"4\"}},[_c('b-form-file',{attrs:{\"plain\":\"\",\"accept\":\".csv\"},model:{value:(_vm.placesFile),callback:function ($$v) {_vm.placesFile=$$v},expression:\"placesFile\"}})],1)],1),_vm._ssrNode(\" \"),_c('b-row',{staticClass:\"mt-3\",attrs:{\"align-h\":\"start\"}},[_c('b-col',{attrs:{\"lg\":\"2\"}},[(!_vm.loading && _vm.report)?_c('b-form-select',{staticClass:\"mb-3\",attrs:{\"options\":_vm.filterOptions,\"value-field\":\"item\",\"text-field\":\"name\"},model:{value:(_vm.statusFilter),callback:function ($$v) {_vm.statusFilter=$$v},expression:\"statusFilter\"}}):_vm._e()],1),_vm._v(\" \"),_c('b-col',{attrs:{\"lg\":\"2\"}},[(!_vm.loading && _vm.csvContent)?_c('b-button',{attrs:{\"href\":(\"data:attachment/csv,\" + (encodeURIComponent(_vm.csvContent))),\"download\":\"places.csv\",\"variant\":\"primary\"}},[_vm._v(\"\\n          Download and correct invalid businesses\\n        \")]):_vm._e()],1)],1),_vm._ssrNode(\" \"),_c('b-row',{attrs:{\"align-h\":\"center\"}},[(_vm.loading)?_c('b-spinner',{staticStyle:{\"width\":\"3rem\",\"height\":\"3rem\"},attrs:{\"label\":\"Loading\"}}):_vm._e()],1),_vm._ssrNode(\" \"),_c('b-row',{staticClass:\"text-center\"},[_c('b-col',{attrs:{\"lg\":\"12\"}},[(!_vm.loading && _vm.error)?_c('h6',{staticClass:\"error\"},[_vm._v(\"\\n          \"+_vm._s(_vm.error)+\"\\n        \")]):_vm._e()])],1),_vm._ssrNode(\" \"),_c('b-row',[_c('b-col',{attrs:{\"lg\":\"12\"}},[(!_vm.loading && _vm.report)?_c('b-table',{staticClass:\"import__table\",attrs:{\"sticky-header\":\"500px\",\"no-border-collapse\":true,\"responsive\":\"\",\"items\":_vm.report,\"fields\":_vm.tableFields,\"head-variant\":\"light\",\"filter-function\":_vm.filterFunction,\"filter\":_vm.statusFilter,\"tbody-tr-class\":_vm.rowClass}}):_vm._e()],1)],1)],2):_vm._e()],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import _ from 'lodash'\nimport Pledgee from './Pledgee'\n\nconst orderKeys = [\n  {\n    label: 'Status',\n    value: 'status'\n  },\n  Pledgee.model.businessName,\n  Pledgee.model.phoneNumber,\n  Pledgee.model.website,\n  Pledgee.model.region,\n  Pledgee.model.seattleNeighborhood\n]\n\nconst getPledgeeKeys = (reportObj) => {\n  const reportKeys = []\n  for (const reportKey in reportObj) {\n    if (orderKeys.filter(orderKey => orderKey.value === reportKey || orderKey === reportKey).length === 0) {\n      reportKeys.push(reportKey)\n    }\n  }\n  return reportKeys\n}\n\n// Get the fields in the order we want them to be\nconst getOrderFields = (reportObj) => {\n  const reportKeys = getPledgeeKeys(reportObj)\n  return _.union(orderKeys, reportKeys)\n}\n\nexport default getOrderFields\n","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { mapGetters, mapActions } from 'vuex'\nimport getOrderFields from '~/models/Report'\nimport Pledgee from '~/models/Pledgee'\nimport axios from 'axios'\nconst csv = require('csvtojson')\nconst { Parser } = require('json2csv')\n\nexport default {\n  data () {\n    return {\n      csvContent: null,\n      loading: false,\n      password: '',\n      isPasswordValid: null,\n      placesFile: null,\n      statusFilter: 'all',\n      filterOptions: [\n        { item: 'all', name: 'All' },\n        { item: 'success', name: 'Success' },\n        { item: 'invalid_phone', name: 'Invalid Phone Number' },\n        { item: 'invalid_website', name: 'Invalid Website' },\n        { item: 'invalid_neighborhood', name: 'Invalid Neighborhood' },\n        { item: 'invalid_region', name: 'Invalid Region' }\n      ],\n      tableFields: [\n        {\n          key: 'status',\n          label: 'Status'\n        },\n        {\n          key: Pledgee.model.businessName,\n          label: 'Business name'\n        },\n        {\n          key: Pledgee.model.region,\n          label: 'Region'\n        },\n        {\n          key: Pledgee.model.seattleNeighborhood,\n          label: 'Seattle Neighborhood'\n        },\n        {\n          key: Pledgee.model.phoneNumber,\n          label: 'Phone Number'\n        },\n        {\n          key: Pledgee.model.website,\n          label: 'Website'\n        }\n      ]\n    }\n  },\n  computed: {\n    ...mapGetters({\n      report: 'places/report',\n      error: 'places/error'\n    })\n  },\n  watch: {\n    report (report) {\n      if (report && report.length) {\n        try {\n          const fields = getOrderFields(report[0])\n          const content = report.filter(item => item.status !== 'success')\n          const jsonToCSVParser = new Parser({ fields })\n          if (content.length > 0) {\n            this.csvContent = jsonToCSVParser.parse(content)\n          }\n          this.loading = false\n          this.placesFile = null\n        } catch (err) {\n          this.setError('An error occurred while generating the csv, please check the logs and try again')\n          this.placesFile = null\n          console.error(err)\n        }\n      }\n    },\n    placesFile (placesFile) {\n      if (this.placesFile) {\n        if (!placesFile.type) {\n          this.setError('The File.type property does not appear to be supported on this browser.')\n          return\n        }\n        if (!placesFile.type.match('.csv') && !placesFile.type.match('application/vnd.ms-excel')) {\n          this.setError('The selected file does not appear to be a csv.')\n          return\n        }\n        const reader = new FileReader()\n        reader.addEventListener('load', event => {\n          this.loading = true\n          csv()\n            .fromString(event.target.result)\n            .then((pledgees) => {\n              this.getReport({ pledgees })\n            })\n        })\n        reader.readAsText(placesFile)\n      }\n    },\n    error (error) {\n      if (error) {\n        this.loading = false\n      }\n    }\n  },\n  methods: {\n    ...mapActions({\n      getReport: 'places/getReport',\n      setError: 'places/setError'\n    }),\n    onScriptLoaded (event = null) {\n      this.loading = false\n    },\n    async verifyPassword () {\n      const { data } = await axios.post('/api/verifyImportPass', { key: this.password })\n      return data.auth\n    },\n    async handlePasswordClick () {\n      const isPasswordCorrect = await this.verifyPassword()\n      if (isPasswordCorrect) {\n        this.isPasswordValid = true\n        this.$cookies.set('import_pass', this.password, 60 * 60 * 24 * 30)\n      } else {\n        this.isPasswordValid = false\n      }\n    },\n    rowClass (item, type) {\n      if (!item || type !== 'row') return\n      switch (item.status) {\n        case 'success':\n          return 'table-success'\n        case 'invalid_phone':\n        case 'invalid_website':\n        case 'invalid_region':\n        case 'invalid_neighborhood':\n          return 'table-danger'\n      }\n    },\n    filterFunction (record, value) {\n      return value === 'all' ? true : record.status === value\n    }\n  },\n  mounted () {\n    if (process.client) {\n      if (this.$cookies.get('import_pass')) {\n        this.isPasswordValid = true\n      }\n    }\n  }\n}\n","import mod from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./import.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/babel-loader/lib/index.js??ref--2-0!../node_modules/@nuxt/components/dist/loader.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./import.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./import.vue?vue&type=template&id=ce08f6cc&scoped=true&\"\nimport script from \"./import.vue?vue&type=script&lang=js&\"\nexport * from \"./import.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./import.vue?vue&type=style&index=0&id=ce08f6cc&lang=scss&scoped=true&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"ce08f6cc\",\n  \"6a4941f4\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACVA;AAAA;AAAA;AAAA;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACNA;AACA;AACA;;;;;;;;;;;;;;;ACFA;AACA;AAEA;AAEA;AACA;AAFA;AACA;AAUA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AAEA;AACA;AAFA;AAKA;AACA;AAFA;AAKA;AACA;AAFA;AAKA;AACA;AAFA;AAKA;AACA;AAFA;AAKA;AACA;AAFA;AApCA;AA0CA;AACA;AAAA;AAEA;AACA;AAFA;AADA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AA9CA;AA+CA;AAEA;AACA;AAFA;AACA;AAGA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AAAA;AACA;AACA;AACA;AApCA;AACA;AAoCA;AACA,iBAIA;AACA;AACA;AA9IA;;ACpIA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}