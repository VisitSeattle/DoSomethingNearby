(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{653:function(e,t,r){var content=r(705);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(120).default)("68798b24",content,!0,{sourceMap:!1})},704:function(e,t,r){"use strict";r(653)},705:function(e,t,r){(t=r(119)(!1)).push([e.i,".error[data-v-ce08f6cc]{color:red}",""]),e.exports=t},737:function(e,t,r){"use strict";r.r(t);r(11),r(8),r(9),r(13),r(14),r(12),r(22),r(178),r(10),r(83);var n=r(40),o=r(2),l=r(121),c=r(637),d=r.n(c),f=r(27),h=[{label:"Status",value:"status"},f.a.model.businessName,f.a.model.phoneNumber,f.a.model.website,f.a.model.region,f.a.model.seattleNeighborhood],v=function(e){var t=function(e){var t=[],r=function(e){0===h.filter((function(t){return t.value===e||t===e})).length&&t.push(e)};for(var n in e)r(n);return t}(e);return d.a.union(h,t)},m=r(106),w=r.n(m);function y(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function _(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(t){Object(o.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var k=r(702),O=r(703).Parser,P={data:function(){return{csvContent:null,loading:!1,password:"",isPasswordValid:null,placesFile:null,statusFilter:"all",filterOptions:[{item:"all",name:"All"},{item:"success",name:"Success"},{item:"invalid_phone",name:"Invalid Phone Number"},{item:"invalid_website",name:"Invalid Website"},{item:"invalid_neighborhood",name:"Invalid Neighborhood"},{item:"invalid_region",name:"Invalid Region"}],tableFields:[{key:"status",label:"Status"},{key:f.a.model.businessName,label:"Business name"},{key:f.a.model.region,label:"Region"},{key:f.a.model.seattleNeighborhood,label:"Seattle Neighborhood"},{key:f.a.model.phoneNumber,label:"Phone Number"},{key:f.a.model.website,label:"Website"}]}},computed:_({},Object(l.c)({report:"places/report",error:"places/error"})),watch:{report:function(e){if(e&&e.length)try{var t=v(e[0]),content=e.filter((function(e){return"success"!==e.status})),r=new O({fields:t});content.length>0&&(this.csvContent=r.parse(content)),this.loading=!1,this.placesFile=null}catch(e){this.setError("An error occurred while generating the csv, please check the logs and try again"),this.placesFile=null,console.error(e)}},placesFile:function(e){var t=this;if(this.placesFile){if(!e.type)return void this.setError("The File.type property does not appear to be supported on this browser.");if(!e.type.match(".csv")&&!e.type.match("application/vnd.ms-excel"))return void this.setError("The selected file does not appear to be a csv.");var r=new FileReader;r.addEventListener("load",(function(e){t.loading=!0,k().fromString(e.target.result).then((function(e){t.getReport({pledgees:e})}))})),r.readAsText(e)}},error:function(e){e&&(this.loading=!1)}},methods:_(_({},Object(l.b)({getReport:"places/getReport",setError:"places/setError"})),{},{onScriptLoaded:function(){this.loading=!1},verifyPassword:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.a.post("/api/verifyImportPass",{key:e.password});case 2:return r=t.sent,data=r.data,t.abrupt("return",data.auth);case 5:case"end":return t.stop()}}),t)})))()},handlePasswordClick:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.verifyPassword();case 2:t.sent?(e.isPasswordValid=!0,e.$cookies.set("import_pass",e.password,2592e3)):e.isPasswordValid=!1;case 4:case"end":return t.stop()}}),t)})))()},rowClass:function(e,t){if(e&&"row"===t)switch(e.status){case"success":return"table-success";case"invalid_phone":case"invalid_website":case"invalid_region":case"invalid_neighborhood":return"table-danger"}},filterFunction:function(e,t){return"all"===t||e.status===t}}),mounted:function(){this.$cookies.get("import_pass")&&(this.isPasswordValid=!0)}},C=(r(704),r(90)),component=Object(C.a)(P,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container"},[e.isPasswordValid||e.loading?e._e():r("div",{staticClass:"mt-5"},[r("b-row",{staticClass:"mb-2",attrs:{"align-h":"center"}},[r("b-col",{attrs:{lg:"4"}},[r("b-form-input",{staticClass:"import__password",attrs:{placeholder:"Enter the password",type:"password",state:e.isPasswordValid,"aria-describedby":"input-live-feedback"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handlePasswordClick(t)}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),r("b-form-invalid-feedback",{attrs:{id:"input-live-feedback"}},[e._v("\n          Please check your password and try again\n        ")])],1)],1),e._v(" "),r("b-row",{attrs:{"align-h":"center"}},[r("b-col",{attrs:{lg:"4"}},[r("b-button",{attrs:{href:"#",block:"",variant:"primary"},on:{click:e.handlePasswordClick}},[e._v("\n          Go\n        ")])],1)],1)],1),e._v(" "),e.isPasswordValid?r("div",[r("b-row",{staticClass:"text-center"},[r("b-col",{staticClass:"mt-5",attrs:{lg:"12"}},[r("h1",{staticClass:"import__title"},[e._v("\n          Visit Seattle\n        ")])])],1),e._v(" "),r("b-row",{staticClass:"mt-3",attrs:{"align-h":"center"}},[r("b-col",{attrs:{lg:"4"}},[r("b-form-file",{attrs:{plain:"",accept:".csv"},model:{value:e.placesFile,callback:function(t){e.placesFile=t},expression:"placesFile"}})],1)],1),e._v(" "),r("b-row",{staticClass:"mt-3",attrs:{"align-h":"start"}},[r("b-col",{attrs:{lg:"2"}},[!e.loading&&e.report?r("b-form-select",{staticClass:"mb-3",attrs:{options:e.filterOptions,"value-field":"item","text-field":"name"},model:{value:e.statusFilter,callback:function(t){e.statusFilter=t},expression:"statusFilter"}}):e._e()],1),e._v(" "),r("b-col",{attrs:{lg:"2"}},[!e.loading&&e.csvContent?r("b-button",{attrs:{href:"data:attachment/csv,"+encodeURIComponent(e.csvContent),download:"places.csv",variant:"primary"}},[e._v("\n          Download and correct invalid businesses\n        ")]):e._e()],1)],1),e._v(" "),r("b-row",{attrs:{"align-h":"center"}},[e.loading?r("b-spinner",{staticStyle:{width:"3rem",height:"3rem"},attrs:{label:"Loading"}}):e._e()],1),e._v(" "),r("b-row",{staticClass:"text-center"},[r("b-col",{attrs:{lg:"12"}},[!e.loading&&e.error?r("h6",{staticClass:"error"},[e._v("\n          "+e._s(e.error)+"\n        ")]):e._e()])],1),e._v(" "),r("b-row",[r("b-col",{attrs:{lg:"12"}},[!e.loading&&e.report?r("b-table",{staticClass:"import__table",attrs:{"sticky-header":"500px","no-border-collapse":!0,responsive:"",items:e.report,fields:e.tableFields,"head-variant":"light","filter-function":e.filterFunction,filter:e.statusFilter,"tbody-tr-class":e.rowClass}}):e._e()],1)],1)],1):e._e()])}),[],!1,null,"ce08f6cc",null);t.default=component.exports}}]);